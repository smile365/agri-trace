# 商品表数据处理逻辑说明

## 处理规则

### 1. 分组字段判断
根据商品表记录中的「分组」字段值来决定数据处理方式：

- **分组字段不为空**: 将记录组合成列表格式
- **分组字段为空**: 将记录处理成直接的键值对

### 2. 分组数据处理（分组字段不为空）

当「分组」字段有值时，相同分组的记录会被组合成一个列表：

```json
{
  "商品信息": [
    {
      "index": 1,
      "商品名称": "农家散养土鸡"
    },
    {
      "index": 2,
      "是否有机": "有机"
    },
    {
      "index": 3,
      "国产/进口": "国产"
    }
  ]
}
```

**处理逻辑**:
1. 按分组字段值进行分组
2. 每个分组内的记录按「顺序」字段排序
3. 为每条记录分配递增的index（从1开始）
4. 记录格式：`{index: 序号, 名称字段: 值}`

### 3. 非分组数据处理（分组字段为空）

当「分组」字段为空时，记录被处理成直接的键值对：

```json
{
  "标题": "云南泽铁苗寨土鸡",
  "监控地址": "xxx",
  "第一次查询时间": "2025-07-01 18:45:16",
  "首图": {
    "file_token": "GDiZb3UvJos7XAxm1f8crccwnng",
    "name": "image.png",
    "url": "https://open.feishu.cn/open-apis/drive/v1/medias/GDiZb3UvJos7XAxm1f8crccwnng/download"
  }
}
```

**处理逻辑**:
- 键名：使用「名称」字段的值
- 键值：优先使用「文本」字段，如果为空则使用「图片」字段，都为空则为空字符串

### 4. 值的优先级规则

对于每条记录的值提取，遵循以下优先级：

1. **文本字段优先**: 如果「文本」字段有值，使用文本内容
2. **图片字段备选**: 如果文本为空但「图片」字段有值，使用图片信息
3. **空值处理**: 如果文本和图片都为空，则值为空字符串

### 5. 图片字段处理

#### 分组数据中的图片
在分组数据中，图片会被提取为简化格式（URL或文件名）

#### 非分组数据中的图片
在非分组数据中，图片保持完整的对象格式，包含：
- `file_token`: 文件令牌
- `name`: 文件名
- `size`: 文件大小
- `type`: 文件类型
- `url`: 下载链接
- `tmp_url`: 临时下载链接

### 6. 排序处理

分组数据会按照「顺序」字段进行排序：
- 有效的数字值按升序排列
- 无效或空值的记录排在最后（默认顺序999）
- 排序后重新分配连续的index值

## 实际数据示例

### 输入数据（飞书表格记录）
```
记录1: 名称="商品名称", 分组="商品信息", 文本="农家散养土鸡", 顺序=1
记录2: 名称="是否有机", 分组="商品信息", 文本="有机", 顺序=2
记录3: 名称="标题", 分组="", 文本="云南泽铁苗寨土鸡", 顺序=null
记录4: 名称="首图", 分组="", 文本="", 图片=[{...}], 顺序=null
```

### 输出数据
```json
{
  "商品信息": [
    {
      "index": 1,
      "商品名称": "农家散养土鸡"
    },
    {
      "index": 2,
      "是否有机": "有机"
    }
  ],
  "标题": "云南泽铁苗寨土鸡",
  "首图": {
    "file_token": "xxx",
    "name": "image.png",
    "url": "https://..."
  }
}
```

## 使用场景

### 前端展示
- **分组数据**: 适合展示为列表或表格形式
- **非分组数据**: 适合展示为单独的信息项

### 数据结构优势
1. **灵活性**: 支持不同类型的数据展示需求
2. **可扩展性**: 新增分组或字段无需修改处理逻辑
3. **一致性**: 统一的数据格式便于前端处理
4. **排序支持**: 分组数据支持自定义排序

## 注意事项

1. **分组字段**: 必须准确设置，影响数据的最终结构
2. **顺序字段**: 影响分组内记录的排列顺序
3. **图片处理**: 分组和非分组数据中图片格式不同
4. **空值处理**: 确保空值情况下的正确处理
