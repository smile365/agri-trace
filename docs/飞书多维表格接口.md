
# 飞书多维表格接口


FeishuApi 基础信息
- base_url：https://base-api.feishu.cn 默认值，可更改
- app_token： 初始化传入
- personal_token：初始化传入

通用请求头：

|名称|位置|类型|必选|说明|
|---|---|---|---|---|
|Authorization|header|string| 是 |none|
|app_token|path|string| 是 |none|

其他类型请求参数：
|名称|位置|类型|必选|说明|
|---|---|---|---|---|
|table_id|path|string| 按需 |none|
|record_id|path|string| 按需 |none|



## GET 列出数据表

GET /open-apis/bitable/v1/apps/{app_token}/tables

## GET 列出数据表字段

GET /open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/fields


## GET 列出所有记录

GET /open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records

## GET 根据记录ID查询记录详情

GET /open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records/{record_id}

## GET 过滤记录

GET /open-apis/bitable/v1/apps/{{app_token}}/tables/tblLDAm0TJxmyU1W/records?filter=CurrentValue.[农户]=\"张三\""


## POST 更新或创建记录

更新记录
POST /open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records/{record_id}

批量创建记录
POST /open-apis/bitable/v1/apps/:app_token/tables/:table_id/records/batch_create

创建记录
POST /open-apis/bitable/v1/apps/:app_token/tables/:table_id/records


json 请求体：
```json
{
  "fields": {
    "文本字段": value
  }
}
```


## POST 删除记录

删除记录
POST /open-apis/bitable/v1/apps/:app_token/tables/:table_id/records/:record_id

批量删除
POST /open-apis/bitable/v1/apps/:app_token/tables/:table_id/records/batch_delete

json 请求体：
```json
{
  "records": [
    "rec123",
    "rec456"
  ]
}
```



## FeishuService 伪代码

- 新建一个 FeishuService 类，用于调用飞书多维表格接口
- 构造参数 app_token、personal_token
私有方法：
- def list_tables() 调用飞书列出数据表接口，返回所有数据表。
- def list_fields(table_name) 调用飞书列出数据表字段接口，返回所有数据表字段      
- def _fmt_time(table_id, record) 对某一行记录中含日期的字段进行格式化
- def cache_tables() 缓存所有数据表 {table_name:table_id}
- def cache_time_fmt() 缓存所有数据表关于所有时间相关字段的格式化 {table_id:{field:time_fmt}
内部方法
- def update_cache() 更新缓存 cache_tables、cache_time_fmt
- def list_records(table_name,time_fmt=True) 获取所有记录,
- def get_record(table_name,record_id,time_fmt=True) 获取一条记录
- def fillter_records(table_name,filter_str,time_fmt=True) 过滤记录
- def update_record(table_name,record_id, data) 更新一条记录
- def create_record(table_name, record) 创建记录
- def delete_record(table_name, record_id) 删除记录
- def batch_create_records(table_name, records) 批量创建记录
- def batch_delete_records(table_name, record_ids) 批量删除记录
- def batch_update_records(table_name, records) 批量更新记录



